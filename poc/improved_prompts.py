"""
LISAæ”¹å–„ç‰ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ - ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æã¨çµ±åˆãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆç”Ÿæˆç”¨
"""
from pathlib import Path

# ============================================================================
# å…¨ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆç”¨ã®æœ€çµ‚ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
# ============================================================================

def get_reflection_prompt() -> str:
    """
    ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å–å¾—
    specialist_persona_prompt_latest.mdã‚’èª­ã¿è¾¼ã‚“ã§your_system_promptã«åŸ‹ã‚è¾¼ã‚€
    """
    # specialist_persona_prompt_latest.mdã®ãƒ‘ã‚¹
    persona_file = Path(__file__).parent / "outputs" / "specialist_persona_prompt_latest.md"

    # ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    try:
        with open(persona_file, 'r', encoding='utf-8') as f:
            your_system_prompt = f.read()
    except FileNotFoundError:
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        your_system_prompt = "ã‚ãªãŸã¯ã€çµŒé¨“è±Šå¯ŒãªPM/SA/å–¶æ¥­ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã§ã™ã€‚"

    return f"""
## ã‚ãªãŸã®å½¹å‰²

{your_system_prompt}


# çµ¶å¯¾éµå®ˆã®ãƒ«ãƒ¼ãƒ«
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã®å‡ºåŠ›é …ç›®ã¯å¿…ãšå®ˆã£ã¦ãã ã•ã„ã€‚
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã®å†…å®¹ã¯é‡è¤‡ã¯ãªã„ã‚ˆã†ã«ã—ã¤ã¤ã€ã§ãã‚‹ã ã‘è©³ç´°ãƒ»å…·ä½“çš„ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã¯10000æ–‡å­—ä»¥ä¸Šã‚’ç›®å®‰ã«ã—ã¦ãã ã•ã„ã€‚
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã®å†…å®¹ã¯DBã¨ã—ã¦ä»Šå¾Œé »ç¹ã«æ‰±ã†é …ç›®ã«ãªã‚Šã¾ã™ã€‚

# ==================== å…¥åŠ›æƒ…å ± ====================

## æ¡ˆä»¶å
{{project_name}}

## å„ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†æçµæœï¼ˆLISAãŒå€‹åˆ¥ã«åˆ†ææ¸ˆã¿ï¼‰
{{summaries_text}}

# ==================== å‡ºåŠ›å½¢å¼ ====================

## ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆ

### 1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼ï¼ˆçµŒå–¶å±¤å‘ã‘ï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœ¬è³ªã‚’3è¡Œã§
- æˆåŠŸç¢ºç‡: â—â—%ï¼ˆæ ¹æ‹ ä»˜ãï¼‰
- æœ€é‡è¦ãƒªã‚¹ã‚¯Top3ã¨å¯¾ç­–

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ï¼ˆ5W1H + 2Hï¼‰
- **When**: æœŸé–“ãƒ»ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
- **Where**: é¡§å®¢ãƒ»å ´æ‰€
- **Who**: ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ãƒãƒƒãƒ—
- **What**: æˆæœç‰©ãƒ»ã‚¹ã‚³ãƒ¼ãƒ—
- **Why**: çœŸã®ç›®çš„ï¼ˆå»ºå‰ã¨æœ¬éŸ³ï¼‰
- **How**: ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãƒ»æŠ€è¡“
- **How Much**: äºˆç®—ãƒ»ROI
- **How Many**: è¦æ¨¡ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ 

### 3. é¡§å®¢ã®æœ€é‡è¦èª²é¡Œï¼ˆ3å±¤æ§‹é€ ï¼‰
- **è¡¨å±¤**: é¡§å®¢ãŒå£ã«ã™ã‚‹èª²é¡Œ
- **ä¸­å±¤**: é¡§å®¢ãŒèªè­˜ã—ã¦ã„ã‚‹çœŸã®èª²é¡Œ
- **æ·±å±¤**: é¡§å®¢ã‚‚æ°—ã¥ã„ã¦ã„ãªã„æœ¬è³ªçš„èª²é¡Œ

### 4. ææ¡ˆã®æ ¸å¿ƒï¼ˆå·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆï¼‰
- **æŠ€è¡“é¢**: ä»–ç¤¾ã«ãªã„æŠ€è¡“å„ªä½æ€§
- **ãƒ“ã‚¸ãƒã‚¹é¢**: ã‚³ã‚¹ãƒˆãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ»å“è³ª
- **äººé–“é¢**: ä¿¡é ¼é–¢ä¿‚ãƒ»å®Ÿç¸¾

### 5. é‡è¦ãªæ„æ€æ±ºå®šã¨æ ¹æ‹ 
å„æ„æ€æ±ºå®šã«ã¤ã„ã¦ï¼š
- æ±ºå®šå†…å®¹
- ä»–ã®é¸æŠè‚¢
- æ±ºå®šç†ç”±ï¼ˆè¡¨å‘ã/æœ¬éŸ³ï¼‰
- ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 6. ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼åˆ¥å¯¾å¿œæˆ¦ç•¥
| ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ | é–¢å¿ƒäº‹ | æ‡¸å¿µäº‹é … | å¯¾å¿œæ–¹é‡ | æ‹…å½“ |
|-----------------|--------|----------|----------|------|
| ã€åå‰ã€‘ | ä½•ã‚’é‡è¦– | ä½•ã‚’å¿ƒé… | ã©ã†å¯¾å¿œ | èª°ãŒ |

### 7. ãƒªã‚¹ã‚¯ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ
| ãƒªã‚¹ã‚¯ | ç™ºç”Ÿç¢ºç‡ | å½±éŸ¿åº¦ | å¯¾ç­– | æ‹…å½“ | æœŸé™ |
|--------|---------|--------|------|------|------|
| ğŸ”´æŠ€è¡“ãƒªã‚¹ã‚¯ | é«˜/ä¸­/ä½ | å¤§/ä¸­/å° | å…·ä½“ç­– | èª°ãŒ | ã„ã¤ |
| ğŸŸ¡çµ„ç¹”ãƒªã‚¹ã‚¯ | é«˜/ä¸­/ä½ | å¤§/ä¸­/å° | å…·ä½“ç­– | èª°ãŒ | ã„ã¤ |
| ğŸŸ¢å¤–éƒ¨ãƒªã‚¹ã‚¯ | é«˜/ä¸­/ä½ | å¤§/ä¸­/å° | å…·ä½“ç­– | èª°ãŒ | ã„ã¤ |

### 8. å®Ÿè¡Œè¨ˆç”»ã¨Quick Win
- **Phase 1ï¼ˆã€œ2é€±é–“ï¼‰**: ä¿¡é ¼ç²å¾—æœŸ
  - Quick Winæ–½ç­–
  - æˆæœã®å¯è¦–åŒ–æ–¹æ³•
- **Phase 2ï¼ˆã€œ1ãƒ¶æœˆï¼‰**: åŸºç›¤æ§‹ç¯‰æœŸ
  - ã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…
  - åˆæœŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†
- **Phase 3ï¼ˆã€œ3ãƒ¶æœˆï¼‰**: æœ¬æ ¼å±•é–‹æœŸ
  - å…¨æ©Ÿèƒ½å®Ÿè£…
  - æ¨ªå±•é–‹æº–å‚™

### 9. æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰
- **å®šé‡æŒ‡æ¨™**: æ•°å€¤ã§æ¸¬å®šå¯èƒ½ãªç›®æ¨™
- **å®šæ€§æŒ‡æ¨™**: æº€è¶³åº¦ãƒ»ä½¿ã„ã‚„ã™ã•
- **éš ã‚ŒãŸæœŸå¾…**: æ˜æ–‡åŒ–ã•ã‚Œã¦ã„ãªã„æˆåŠŸåŸºæº–

### 10. å¼•ç”¨å…ƒã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹
é‡è¦ãªæ±ºå®šãƒ»ç™ºè¨€ã®å‡ºå…¸ã‚’æ˜è¨˜ï¼š
- ã€ãƒ•ã‚¡ã‚¤ãƒ«åã€‘: è©²å½“ç®‡æ‰€ã®å¼•ç”¨
- ã€è­°äº‹éŒ²_æ—¥ä»˜ã€‘: ç™ºè¨€è€…ã¨å†…å®¹
- ã€Slack_ãƒãƒ£ãƒ³ãƒãƒ«ã€‘: é‡è¦ãªã‚„ã‚Šå–ã‚Š

### 11. LISAã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ï¼ˆAIç‹¬è‡ªã®æ´å¯Ÿï¼‰
- **ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜**: éå»ã®é¡ä¼¼æ¡ˆä»¶ã¨ã®æ¯”è¼ƒ
- **ç•°å¸¸æ¤œçŸ¥**: é€šå¸¸ã¨ã¯ç•°ãªã‚‹å…†å€™
- **äºˆæ¸¬åˆ†æ**: 3ãƒ¶æœˆå¾Œã®çŠ¶æ³äºˆæ¸¬
- **æ¨å¥¨äº‹é …**: ã‚¨ãƒ¼ã‚¹ç´šPMãªã‚‰ã“ã†ã™ã‚‹

---
æ³¨è¨˜ï¼š
- [æ¨æ¸¬]ã‚¿ã‚°: AIã«ã‚ˆã‚‹æ¨æ¸¬
- [è¦ç¢ºèª]ã‚¿ã‚°: äººé–“ã«ã‚ˆã‚‹ç¢ºèªãŒå¿…è¦
- [ãƒªã‚¹ã‚¯]ã‚¿ã‚°: ç‰¹ã«æ³¨æ„ãŒå¿…è¦ãªäº‹é …

ã™ã¹ã¦ã®å›ºæœ‰åè©ã¯ã€ã€‘ã§å›²ã¿ã€
æ—¥ä»˜ã¯ã€YYYYå¹´MMæœˆDDæ—¥ã€‘å½¢å¼ã§çµ±ä¸€ã—ã¦ãã ã•ã„ã€‚

ã“ã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã¯ã€Œç”ŸããŸæ–‡æ›¸ã€ã¨ã—ã¦ã€
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²è¡Œã¨ã¨ã‚‚ã«ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚"""

# ============================================================================
# é–¢æ•°ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
# ============================================================================

def get_final_reflection_prompt(project_name: str, summaries_text: str) -> str:
    """
    æœ€çµ‚ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ

    Args:
        project_name: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
        summaries_text: å„ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†æçµæœã‚’çµåˆã—ãŸãƒ†ã‚­ã‚¹ãƒˆ

    Returns:
        å®Œæˆã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–‡å­—åˆ—
    """

    reflection_prompt = get_reflection_prompt()

    return reflection_prompt.format(
        project_name=project_name,
        summaries_text=summaries_text
    )
